# Отмена изменений: undo, reset, revert

Как откатить незакоммиченные правки, последний коммит или уже запушенную историю.

## Цель

- Понять разницу между отменой в рабочей копии, reset и revert.
- Выбирать безопасный способ в зависимости от ситуации.

## Отмена в рабочей копии (ещё не коммитил)

- **Один файл к версии из индекса:** `git restore путь/к/файлу` (или `git checkout -- файл`).
- **Весь рабочий каталог к последнему коммиту:** `git restore .` (осторожно: все несохранённые изменения пропадут).
- **Убрать файл из индекса (оставить изменения в файле):** `git restore --staged путь/к/файлу`.

## reset — отмена коммитов локально

- **Мягкий (сохранить изменения в индексе):** `git reset --soft HEAD~1` — последний коммит «исчезает», изменения остаются в staged.
- **Смешанный (по умолчанию):** `git reset HEAD~1` — коммит отменён, изменения в рабочей копии (unstaged).
- **Жёсткий (удалить и коммит, и изменения):** `git reset --hard HEAD~1` — всё от последнего коммита стирается. Использовать только если уверен.

**Важно:** reset меняет историю. Если коммит уже запушен, после reset понадобится `git push --force`. В общих ветках force push опасен — лучше revert.

## revert — отмена коммита новым коммитом

- **Отменить последний коммит:** `git revert HEAD --no-edit`.
- **Отменить конкретный коммит:** `git revert <SHA> --no-edit`.

Revert не переписывает историю: создаётся новый коммит, который отменяет изменения указанного. Безопасно для уже запушенных коммитов и общих веток.

## Когда что применять

| Ситуация | Действие |
|----------|----------|
| Ещё не коммитил, хочешь отменить правки в файле | `git restore файл` |
| Закоммитил только что, не пушил, хочешь «разкоммитить» | `git reset --soft HEAD~1` или `git reset HEAD~1` |
| Уже запушил, нужно откатить последний коммит в общей ветке | `git revert HEAD` затем `git push` |
| Своя ветка, не пушил — можно переписать историю | `git reset --hard HEAD~1` (осторожно) |

## Проверка

- После `git reset --soft HEAD~1`: `git status` покажет изменения в staged; `git log` — последний коммит исчез.
- После `git revert HEAD`: `git log -1` покажет новый коммит с сообщением вида «Revert "..."».

## Типовые ошибки

- **reset --hard после push** — история на remote не изменится, пока не сделаешь `git push --force`. В main/master лучше не делать force без согласования.
- **revert конфликтующиго коммита** — возможны конфликты; разреши их, затем `git add` и `git revert --continue` (или заверши коммит вручную).
